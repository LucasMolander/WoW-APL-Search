# WoW-APL-Search
Searches through the space of Action Priority Lists to find the best one.

## APL Codegen (.simc --> .cpp)
APLs are typically written in human-readable form (TCI, aka
[TextualConfigurationInterface](github.com/simulationcraft/simc/wiki/TextualConfigurationInterface)
), usually in files with the `.simc` extension. For example,
[T29_Death_Knight_Unholy.simc](github.com/simulationcraft/simc/blob/84ea508e96575079df70d00c9a2ce61eca3bb7f1/profiles/Tier29/T29_Death_Knight_Unholy.simc):
```
deathknight="T29_Death_Knight_Unholy"
source=default
spec=unholy
# ...

# Default consumables
potion=elemental_potion_of_ultimate_power_3
# ...

# Executed before combat begins. Accepts non-harmful actions only.
actions.precombat=flask
# ...

# Executed every time the actor is available.
actions=auto_attack

# Also do actions.aoe, actions.cooldowns, actions.generic, actions.opener, actions.racials, actions.trinkets

head=maw_of_the_haunted_frostbrood,id=200408,bonus_id=4800/4786/1498/6935,gem_id=192985
# ...

# Gear Summary
# gear_ilvl=422.20
# gear_strength=5445
# ...
```

`simc` is converted into `cpp` code via
[ConvertAPL.py](github.com/simulationcraft/simc/blob/dragonflight/engine/class_modules/apl/ConvertAPL.py)

For example,
[apl_death_knight.cpp](https://github.com/simulationcraft/simc/blob/dragonflight/engine/class_modules/apl/apl_death_knight.cpp):
```
// Headers

namespace death_knight_apl {

std::string potion( const player_t* p )
{
  // ...
}

//blood_apl_start
void blood( player_t* p )
{
  action_priority_list_t* default_ = p->get_action_priority_list( "default" );
  // ...

  precombat->add_action( "flask" );

  // Also add actions to default_, drw_up, racials, standard, trinkets
}
//blood_apl_end

//frost_apl_start

// ...

}  // namespace death_knight_apl
```

The C++ code is what's actually used by the simuation.

### SIMC Generation
The `.simc` file that's converted to C++ code is, itself, codegen'd.

There is one file per *class* in `profiles/generators/Tier29/`
that has one section like this per spec (basically just metadata and gear),
e.g. [T29_Generate_Death_Knight.simc](github.com/simulationcraft/simc/blob/84ea508e96575079df70d00c9a2ce61eca3bb7f1/profiles/generators/Tier29/T29_Generate_Death_Knight.simc):
```
deathknight="T29_Death_Knight_Blood"
level=70
# etc.

head=maw_of_the_haunted_frostbrood,id=200408,bonus_id=4800/4786/1498/1808,gem_id=192925
# etc.

save=T29_Death_Knight_Blood.simc
```

There is also a special `.simc` file
[T29_Generate.simc](github.com/simulationcraft/simc/blob/84ea508e96575079df70d00c9a2ce61eca3bb7f1/profiles/generators/Tier29/T29_Generate.simc)
that just includes every profile in the folder, e.g.
```
# ...

# Death Knight
T29_Generate_Death_Knight.simc

# ...
```

For each of those sections, there is a full `.simc` APL in the folder `profiles/Tier29/`,
e.g. `T29_Death_Knight_Unholy.simc` from above.

That "final" profiles are generated by
[generate_profiles.sh](github.com/simulationcraft/simc/blob/e411eeaf76a9322518d719da1c637b2153c2ea7f/generate_profiles.sh),
which boils down to
```
SIMC=${SIMC:-../../engine/simc}
# ...
for tier in 29
do
  PROFDIR="Tier$tier"
  echo "---$PROFDIR---"
  if [ ! -d $PROFDIR ]; then
    echo "Skipped $PROFDIR, directory not found."
    continue
  fi
  cd $PROFDIR/
  ${SIMC} '../generators/Tier'$tier'/T'$tier'_Generate.simc'
  cd ../
done
```

And that uses the

## Info
Python version `3.7.4`.
